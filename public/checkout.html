<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Thanh toán - Nhi Nhi Quán</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="icon" type="image/png" sizes="16x16" href="/img/logo.jpg" />
    <!-- Lucide icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body>
    <!-- ============ Header ============ -->
    <header>
      <div class="container">
        <div class="brand">
          <div class="logo">
            <img src="img/logo.jpg" alt="Nhi Nhi Quán" />
          </div>
          <h1>Hệ Thống Quay Nướng Gà Vịt Nhi Nhi</h1>
        </div>

        <!-- Nav chính -->
        <nav class="primary">
          <a href="index.html"> <i data-lucide="home"></i> Trang chủ </a>
          <a href="menu.html"><i data-lucide="utensils-crossed"></i> Menu</a>
          <a href="track.html"><i data-lucide="search"></i> Theo dõi đơn</a>
        </nav>

        <!-- Cart icon luôn hiển thị -->
        <a href="/checkout.html" class="cart-link">
          <i data-lucide="shopping-cart"></i>
          <span id="cartBadge" class="cart-badge">0</span>
        </a>

        <!-- Nút mở menu di động -->
        <button id="menuBtn" class="btn outline" aria-label="menu">
          <i data-lucide="menu"></i>
        </button>

        <!-- Switch theme -->
        <label class="switch">
          <input type="checkbox" id="themeSwitch" />
          <span class="icon"><i data-lucide="sun"></i></span>
        </label>
      </div>

      <aside id="drawer" class="drawer" aria-hidden="true">
        <a href="index.html"><i data-lucide="home"></i> Trang chủ</a>
        <a href="menu.html"><i data-lucide="utensils-crossed"></i> Xem Menu</a>
        <a href="track.html"><i data-lucide="search"></i> Theo dõi đơn</a>
      </aside>
    </header>

    <!-- ============ Main ============ -->
    <main class="container">
      <div class="grid-2">
        <!-- ===== Form ===== -->
        <section class="checkout-section">
          <h2 class="section-title">Thông tin khách hàng</h2>

          <form id="checkoutForm" class="checkout-form">
            <label
              >Họ và tên
              <input type="text" id="name" required class="input-field" />
            </label>

            <label
              >Số điện thoại
              <input type="tel" id="phone" required class="input-field" />
            </label>

            <label
              >Địa chỉ giao hàng
              <input
                type="text"
                id="address"
                placeholder="Số nhà, đường, phường/xã, quận/huyện (để trống nếu ăn tại quán)"
                class="input-field"
              />
            </label>

            <fieldset class="form-group">
              <legend>Hình thức đặt</legend>
              <label class="row">
                <input
                  type="radio"
                  name="orderType"
                  value="TAKEAWAY"
                  checked
                  class="radio-input"
                />
                Mang đi
              </label>
              <label class="row">
                <input
                  type="radio"
                  name="orderType"
                  value="DINE_IN"
                  class="radio-input"
                />
                Tại bàn
              </label>
              <label class="row">
                <input
                  type="radio"
                  name="orderType"
                  value="RESERVE"
                  class="radio-input"
                />
                Đặt trước đến ăn
              </label>
            </fieldset>

            <div id="typeFields" class="card">
              <div data-type="TAKEAWAY">
                <label
                  >Thời gian lấy (tuỳ chọn)
                  <input
                    type="datetime-local"
                    id="pickupAt"
                    class="input-field"
                  />
                </label>
              </div>

              <div data-type="DINE_IN" class="hidden">
                <label
                  >Số bàn (tuỳ chọn)
                  <input
                    type="text"
                    id="tableNumber"
                    placeholder="VD: B12"
                    class="input-field"
                  />
                </label>
                <label
                  >Số khách
                  <input
                    type="number"
                    id="guests_dinein"
                    min="1"
                    placeholder="VD: 4"
                    class="input-field"
                  />
                </label>
              </div>

              <div data-type="RESERVE" class="hidden">
                <label
                  >Thời gian đến (bắt buộc)
                  <input
                    type="datetime-local"
                    id="reserveAt"
                    class="input-field"
                  />
                </label>
                <label
                  >Số khách
                  <input
                    type="number"
                    id="guests_reserve"
                    min="1"
                    placeholder="VD: 6"
                    class="input-field"
                  />
                </label>
              </div>

              <label
                >Ghi chú
                <textarea
                  id="note"
                  rows="2"
                  placeholder="Ghi chú cho quán..."
                  class="input-field textarea"
                ></textarea>
              </label>
            </div>

            <fieldset class="form-group">
              <legend>Phương thức thanh toán</legend>
              <label class="row">
                <input
                  type="radio"
                  name="payment"
                  value="COD"
                  checked
                  class="radio-input"
                />
                Thanh toán khi nhận (COD)
              </label>
              <label class="row">
                <input
                  type="radio"
                  name="payment"
                  value="TRANSFER"
                  class="radio-input"
                />
                Chuyển khoản (hiển thị QR)
              </label>
            </fieldset>

            <button class="btn primary submit-btn" type="submit">
              <i data-lucide="check-circle-2"></i> Đặt hàng
            </button>
          </form>

          <!-- Hộp QR chuyển khoản (ẩn/hiện theo lựa chọn) -->
          <div id="transferBox" class="hidden card transfer-box">
            <h3 class="section-title">Chuyển khoản</h3>
            <p><b>Ngân hàng:</b> <span id="bankName"></span></p>
            <p><b>Tên TK:</b> <span id="bankAccName"></span></p>
            <p><b>Số TK:</b> <span id="bankAccNumber"></span></p>

            <div id="qrWrap">
              <img id="qrImg" alt="VietQR" class="qr-image" />
              <div class="row" style="gap: 8px; justify-content: space-between">
                <a
                  id="qrDownload"
                  class="btn outline"
                  href="#"
                  download="VietQR.png"
                >
                  <i data-lucide="download"></i> Tải QR
                </a>
                <button id="qrCopy" class="btn outline" type="button">
                  <i data-lucide="copy"></i> Sao chép số TK
                </button>
              </div>
              <p class="muted" id="qrCaption"></p>
            </div>
          </div>

          <!-- Kết quả sau khi tạo đơn -->
          <div id="result" class="hidden card result-box"></div>
        </section>

        <!-- ===== Cart ===== -->
        <aside class="cart-section">
          <h2 class="section-title">Giỏ hàng</h2>
          <div id="promoNote" class="muted"></div>
          <div id="cartItems" class="cart-items"></div>
          <div class="total card">
            Tạm tính: <span id="cartSubtotal">0</span><br />
            Giảm: <span id="cartDiscount">0</span><br />
            <b>Tổng cộng: <span id="cartTotal">0</span></b>
          </div>
        </aside>
      </div>
    </main>

    <!-- ============ Footer ============ -->
    <footer class="site-footer">
      <div class="footer-wrap container">
        <!-- Cột 1 -->
        <section class="footer-brand">
          <div class="brandline">
            <img
              class="footer-logo"
              src="/img/logo.jpg"
              alt="Hệ Thống Quay Nướng Gà Vịt Nhi Nhi"
            />
            <div>
              <h4 class="footer-title">Hệ Thống Quay Nướng Gà Vịt Nhi Nhi</h4>
              <p class="footer-tag">Gà nướng mắm nhĩ · Vịt quay ngũ vị</p>
            </div>
          </div>

          <ul class="contact-list">
            <li class="contact-item">
              <i data-lucide="phone"></i>
              <div>
                <div>Liên hệ đặt món</div>
                <a href="tel:0906919019"><b>0906.919.019</b></a>
              </div>
            </li>
            <li class="contact-item">
              <i data-lucide="map-pin"></i>
              <div>
                <div>Địa chỉ</div>
                <a
                  href="https://maps.google.com/?q=63+T%C3%B4n+%C4%90%E1%BB%A9c+Th%E1%BA%AFng,+Tam+K%E1%BB%B3,+Qu%E1%BA%A3ng+Nam"
                  target="_blank"
                  rel="noopener"
                >
                  <b
                    >63 Tôn Đức Thắng, Phường An Sơn, Tam Kỳ, Quảng Nam, Việt
                    Nam</b
                  >
                </a>
              </div>
            </li>
            <li class="contact-item">
              <i data-lucide="clock-3"></i>
              <div>Mở cửa hằng ngày · Giao nhanh nội thành</div>
            </li>
          </ul>
        </section>

        <!-- Cột 2 -->
        <section class="footer-hours">
          <h5>Giờ mở cửa</h5>
          <ul class="hours">
            <li>Thứ 2 – Chủ nhật: <b>10:00 – 21:00</b></li>
          </ul>

          <h5 style="margin-top: 14px">Liên kết nhanh</h5>
          <nav class="quick-links">
            <a href="/menu.html"><i data-lucide="chef-hat"></i> Xem menu</a>
            <a href="/checkout.html"
              ><i data-lucide="shopping-cart"></i> Giỏ hàng</a
            >
            <a href="/track.html"><i data-lucide="search"></i> Theo dõi đơn</a>
          </nav>
        </section>

        <!-- Cột 3 -->
        <section class="map-card" aria-label="Bản đồ">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3843.5859619646344!2d108.49100927828695!3d15.560311046494757!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3169dd004e338171%3A0xa99a1decfeb7cca0!2zSOG7hyBUaOG7kW5nIFF1YXkgTsaw4bubbmcgR8OgIFbhu4t0IE5oaSBOaGk!5e0!3m2!1svi!2sus!4v1757264543675!5m2!1svi!2sus"
            width="600"
            height="450"
            style="border: 0"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
          >
          </iframe>
        </section>
      </div>

      <div class="footer-bar">
        © <span id="y"></span> Nhi Nhi · Made with luuquancoder
      </div>
    </footer>

    <!-- ============ Scripts ============ -->
    <script>
      (function () {
        try {
          const y = document.getElementById("y");
          if (y) y.textContent = new Date().getFullYear();
          if (window.lucide) window.lucide.createIcons();
        } catch (e) {}
      })();
    </script>

    <!-- Khởi tạo UI + Toast trước, rồi mới nạp checkout.js -->
    <script type="module">
      import { initUI } from "/js/ui.js";
      import { toast } from "/js/toast.js";
      // Gắn global để có thể gọi ở bất kỳ file logic nào (ví dụ track.js/checkout.js)
      window.toast = toast;
      initUI();
    </script>

    <script type="module" src="/js/checkout.js"></script>
  </body>
</html>
